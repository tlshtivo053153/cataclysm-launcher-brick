## 1. Overview
This file summarizes the current state of the Cataclysm:DDA Launcher project to resume work in a new chat session.

## 2. Current Status

### 2.1. Completed Features
- **Core Infrastructure:** Project structure, Dhall configuration, and basic TUI layout with `brick`.
- **GitHub Integration:** Fetching release information from the GitHub API, including a file-based caching mechanism to avoid rate-limiting.
- **UI:** Displaying available (from GitHub) and installed (from local disk) game versions in separate, switchable lists.
- **Asynchronous Operations:** Implemented non-blocking downloads using `forkIO` and `BChan`, allowing the UI to remain responsive.
- **Error Handling:** The background thread now correctly reports success or failure back to the UI thread, which displays the message in the status bar without crashing.

### 2.2. Current Blocker
The primary issue is the **failure to correctly extract downloaded `.tar.gz` archives**.

-   **Symptom:** The application reports `"Error: No files were extracted from tar."` or `"Download and installation complete."` but the target directory remains empty.
-   **Root Cause:** The extraction logic in `GameManager.hs` does not correctly handle archives where all files reside within a common base directory (e.g., `cataclysmdda-0.I/`). The current path validation logic incorrectly flags all files as a path traversal risk, causing them to be skipped.
-   **Secondary Cause:** Repeated build errors related to the misunderstanding of the `Codec.Archive.Tar.foldEntries` API have hindered progress on fixing the root cause.

## 3. Next Steps

The immediate goal is to fix the archive extraction logic.

1.  **Re-implement `extractTar` and `extractZip` in `GameManager.hs`:**
    -   Strictly follow the documentation provided for `foldEntries` (`@docs/haskell/tar-0.5.1.1/foldEntries.md`) to correctly process archive entries.
    -   **Implement Common Prefix Stripping:**
        -   First, iterate through all entry paths to find a common base directory (e.g., `cataclysmdda-0.I/`).
        -   Then, during extraction, strip this common prefix from each entry's path before prepending the final installation directory.
    -   **Maintain Security:** Ensure the final, normalized path is still validated to be within the installation directory to prevent path traversal attacks.
2.  **Implement Permissions Setting:**
    -   After a successful extraction, add a step to set execute permissions on the `cataclysm-launcher` and `cataclysm-tiles` files. This requires the `unix` package.
3.  **Implement Game Launch:**
    -   Once extraction and permissions are working, re-implement the `launchGame` function to run the `cataclysm-launcher` script from the correct working directory. This requires the `process` package.
4.  **Commit:** After successful verification of the above fixes, create a git commit.
