### テスト計画: MOD管理機能の改善

**テストの目的:**
今回追加・変更したコードに対するテスト計画を立てます。

**テストの目的:**
今回追加・修正したMOD管理機能のロジックが、仕様通りに正しく動作することを確認します。特に、以下の点に焦点を当てます。

1.  **MODソースの読み込み:** `config/mods.dhall` が正しくパースされること。
2.  **MODリストの統合:** 設定ファイル由来のMODソースと、ファイルシステム上のインストール済みMODが、重複や欠落なく正しく一つのリストに統合されること。
3.  **状態更新のトリガー:** MODのインストールや有効化といった非同期処理の完了後、状態を更新するためのイベントが正しく発行されること。

**テスト対象モジュール:**

*   `Config.hs`: `loadModSources`
*   `Main.hs`: `initialState` を構築する際のMODリスト統合ロジック
*   `Events.hs`: `ModInstallFinished`, `ModEnableFinished` などのイベントハンドラと、`refreshAvailableModsList` などの状態更新関数

**テスト戦略:**

`Main.hs` と `Events.hs` のロジックはUIの状態（`EventM Name AppState`）に強く依存しており、`brick` ライブラリのテストフレームワーク (`brick-test`) を導入しない限り、直接的なユニットテストは困難です。

そこで、より現実的で効果的なアプローチとして、**UIから分離可能な純粋なロジックをテストする**ことに集中します。

1.  **`ConfigSpec.hs` (新規作成):**
    *   `loadModSources` 関数のテストを実装します。
    *   **テストケース:**
        *   正常な `mods.dhall` ファイルを読み込めること。
        *   フィールド名が不正な `mods.dhall` を読み込もうとした際に、適切にエラー（あるいは空リスト）が返されること。
        *   `mods.dhall` が存在しない場合に、空のリストが返されること。

2.  **`ModHandlerSpec.hs` (既存のテストを拡張):**
    *   `installModFromGitHub` が、引数で渡されたリポジトリ名 (`msiRepositoryName`) を使って正しいディレクトリにクローンすることを確認するテストを追加します。

3.  **`MainSpec.hs` (新規作成):**
    *   `Main.hs` の `main` 関数内にあるMODリストの統合ロジックを、テスト可能な純粋関数として抽出し、それをテストします。
    *   **抽出する関数:** `combineMods :: [ModSourceInfo] -> [ModInfo] -> [AvailableMod]`
    *   **テストケース:**
        *   設定ファイルにのみ存在するMODは、`amIsInstalled = False` となること。
        *   ファイルシステムにのみ存在するMOD（手動追加されたMOD）が、リストに正しく追加されること。
        *   設定ファイルとファイルシステムの両方に存在するMODは、重複せず、`amIsInstalled = True` となること。
        *   空のリスト同士を統合した場合、結果も空になること。

**実装ステップ:**

1.  **`Main.hs` のリファクタリング:**
    *   `main` 関数内のMODリスト統合ロジックを、`combineMods` という名前の独立した純粋関数として `Main.hs` 内（あるいは新しいヘルパーモジュール）に切り出します。
    *   `main` 関数はこの `combineMods` を呼び出すように変更します。

2.  **テストファイルの作成:**
    *   `test/ConfigSpec.hs` を新規作成します。
    *   `test/MainSpec.hs` を新規作成します。

3.  **テストの実装:**
    *   `hspec` と `QuickCheck` (必要であれば) を用いて、上記テストケースを実装します。
    *   ファイルI/Oを伴うテスト（`loadModSources`）では、`hspec` の `around` や `before` フックを使って、一時的な設定ファイルを作成・削除するテスト環境を構築します。
