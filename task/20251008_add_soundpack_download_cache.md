### 計画：サウンドパックダウンロードへのキャッシュ機能追加

この計画は、コードの再利用性を高めるために、まず汎用的なキャッシュダウンロード機能を実装し、その後、既存のゲームダウンロードと新規のサウンドパックダウンロードの両方がその機能を利用するようにリファクタリングする、という手順で進めます。

**ステップ 1: 汎用的なキャッシュ管理モジュールの準備**

1.  **`ContentManager.hs` のリファクタリング:**
    *   現在 `GameManager/Install.hs` に実装されているゲームのダウンロードとキャッシュのロジックを、より汎用的なモジュールである `src/ContentManager.hs` に移動させます。
    *   `downloadWithCache` という名前で新しい関数を作成します。この関数は以下の責務を持ちます。
        *   指定されたURLからコンテンツをダウンロードする。
        *   キャッシュ設定が有効な場合、まずキャッシュディレクトリ内にファイルが存在するか確認する。
        *   ファイルが存在すればダウンロードをスキップし、キャッシュファイルのパスを返す。
        *   ファイルが存在しない場合、ダウンロードを実行し、ダウンロードしたファイルをキャッシュディレクトリに保存してから、そのパスを返す。

**ステップ 2: 設定の追加**

1.  **`Config` 型の拡張:**
    *   `src/Types/Domain.hs` 内の `Config` レコードに、サウンドパックのキャッシュを制御するための `useSoundpackCache :: Bool` フィールドを追加します。
2.  **設定ファイルの更新:**
    *   `config/launcher.dhall` に `useSoundpackCache` を追加し、デフォルト値を `True` に設定します。
3.  **設定読み込み処理の更新:**
    *   `src/Config.hs` を修正し、アプリケーション起動時に `useSoundpackCache` を読み込むようにします。

**ステップ 3: 既存機能のリファクタリング**

1.  **ゲームダウンロード処理の更新:**
    *   `src/GameManager/Install.hs` を修正し、ステップ1で作成した汎用的な `ContentManager.downloadWithCache` 関数を呼び出すように変更します。これにより、既存のゲームダウンロード機能の動作を変えずに、実装をよりクリーンにします。

**ステップ 4: サウンドパックダウンロードへのキャッシュ機能実装**

1.  **`SoundpackManager.hs` の更新:**
    *   `src/SoundpackManager.hs` 内でサウンドパックをダウンロードしている箇所を修正します。
    *   ここでも `ContentManager.downloadWithCache` 関数を呼び出すように変更します。この際、`Config` から `useSoundpackCache` の設定値を参照し、キャッシュの有効・無効を正しくハンドリングします。

**ステップ 5: テストの追加と更新**

1.  **`ContentManager` の単体テスト:**
    *   `test/ContentManagerSpec.hs` を作成し、`downloadWithCache` 関数のための単体テストを実装します。以下の3つのシナリオをテストします。
        *   キャッシュが有効で、キャッシュが存在する場合（ダウンロードがスキップされること）。
        *   キャッシュが有効で、キャッシュが存在しない場合（ダウンロードとキャッシュへの保存が行われること）。
        *   キャッシュが無効な場合（常にダウンロードが行われること）。
2.  **既存テストの更新:**
    *   `test/GameManager/InstallSpec.hs` を見直し、ステップ3のリファクタリング後もテストがパスすることを確認、必要であれば修正します。
3.  **`SoundpackManager` のテスト:**
    *   `test/SoundpackManagerSpec.hs` に、サウンドパックのダウンロードがキャッシュ機能を正しく利用していることを検証するテストケースを追加します。

この計画に従うことで、機能追加と同時にコードベース全体の品質向上（DRY原則の徹底）を目指します。
