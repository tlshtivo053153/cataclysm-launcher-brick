# 2025年8月4日: 未達・不足タスクの計画

`task/20250630.md` の初期計画に基づき、現状のコードベースを分析し、未完了または不足しているタスクを洗い出して計画を立てる。

## フェーズ1: 品質保証基盤の構築 (最優先)

### 1.1. 統合テストの実装
- **タスク:** `test/IntegrationSpec.hs` を新規作成する。
- **内容:** 主要モジュール間の連携を検証する。最低でも以下のシナリオをカバーする。
  - 設定ファイルの読み込みからGitHubリリースの取得まで。
  - ゲームのダウンロード、キャッシュ、展開。
  - サンドボックス環境下でのゲーム起動。
- **ゴール:** モジュール間のデータフローと副作用が正しく連携することを確認する。

### 1.2. ContentManagerのテスト実装
- **タスク:** `test/ContentManagerSpec.hs` を新規作成する。
- **内容:** `ContentManager` のロジックを検証する。
  - `sys-repo` と `user-repo` のスキャンとリスト生成。
  - `user-repo` によるオーバーライドロジックの検証。
- **ゴール:** コンテンツ統合管理のコアロジックの信頼性を確保する。

### 1.3. E2Eテストの導入
- **タスク:** E2Eテストのフレームワークを選定し、基本的なセットアップを行う。
- **内容:** TUIアプリケーションのテストに適したツール（例: `hspec-expectations-pretty-diff` と組み合わせたカスタムスクリプトなど）を導入し、最初のテストケース（アプリケーションの起動と終了）を実装する。
- **ゴール:** 自動化されたE2Eテストを実行できる環境を構築する。

### 1.4. 主要E2Eテストケースの実装
- **タスク:** 主要なユーザーシナリオに基づき、E2Eテストケースを実装する。
- **内容:**
  - 利用可能なバージョンの表示。
  - 特定のバージョンのダウンロードとインストール。
  - サンドボックスを作成してゲームを起動。
- **ゴール:** `4. Goal` で定義された15件のテストケースのうち、少なくとも5件の基盤となるテストを実装する。

## フェーズ2: 高度な機能の実装

### 2.1. バックアップシステムの強化
- **タスク:** バックアップの世代管理とローテーション機能を実装する。
- **内容:** 設定ファイル（`config.dhall`）で指定された最大バックアップ数に基づき、古いバックアップを自動的に削除する機能を `BackupSystem` に追加する。
- **ゴール:** ディスク容量の圧迫を防ぎ、バックアップ管理を自動化する。

### 2.2. MOD管理の強化
- **タスク:** MODの依存関係解決と互換性チェック機能を実装する。
- **内容:** `ModHandler` に、MODのメタデータ（`modinfo.json`など）を解析し、依存関係を解決するロジックを追加する。
- **ゴール:** ユーザーが手動で依存関係を解決する手間を省く。

## フェーズ3: 信頼性と運用性の向上

### 3.1. GitHub API認証の実装
- **タスク:** GitHub Personal Access Token (PAT) を利用した認証リクエスト機能を実装する。
- **内容:** `Config.hs` と `GitHubIntegration.hs` を変更し、設定ファイルからPATを読み込み、APIリクエストのヘッダーに含めるようにする。
- **ゴール:** GitHub APIのレートリミット問題を緩和し、安定した運用を可能にする。

### 3.2. 構造化ロギングの導入
- **タスク:** `katip` などのライブラリを用いて、構造化ロギングを導入する。
- **内容:** 主要な関数（ゲームの起動、ダウンロード、エラーハンドリングなど）に、コンテキスト情報（バージョンID、サンドボックス名など）を含むログ出力処理を追加する。
- **ゴール:** デバッグと障害追跡の効率を大幅に向上させる。
